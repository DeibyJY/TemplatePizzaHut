{%- liquid
  assign product = all_products[settings.cart_product_gift]
  assign product_downcase = product | downcase
  assign id = product.selected_or_first_available_variant.id | minus: 0

  assign check = false
  for item in cart.items
    if item.id == id
      assign check = true
    endif
  endfor
-%}
{% unless cart == empty %}
  <div class="previewCart">
    <ul class="previewCartList list-unstyled">
      {%- for item in cart.items -%}
        {% comment %}
          <li class="previewCartItem clearfix" data-item-row>
            <a href="{{ item.url }}" class="previewCartItem-image">
              <img
                srcset="{{ item.image | img_url: '110x' }}"
                src="{{ item.image | img_url: '110x' }}"
                width="110"
                height="{{ 110 | divided_by: item.image.aspect_ratio | round }}"
                alt="{{ item.title | escape }}"
                sizes="auto"
                loading="lazy"
              >
            </a>
            <div class="previewCartItem-content cart-item-block-right">
              {%- liquid
                assign thisHandle = item.product.handle
                assign thisProduct = all_products[thisHandle]
              -%}
              <script type="text/javascript">
                window.cart_selling_array_{{ thisProduct.id }} = {
                    {% for variantProduct in thisProduct.variants %}
                        '{{ variantProduct.id }}': '{{ variantProduct.inventory_policy }}',
                    {%endfor%}
                };
              </script>

              {%- if item.product.variants.size != 0 -%}
                {%- unless item.variant.title contains 'Default' -%}
                  <div class="previewCartItem-options">
                    <span class="previewCartItem-variant">
                      {{ item.variant.title }}
                    </span>
                    {%- if settings.show_quick_edit_cart -%}
                      <button
                        type="button"
                        class="previewCartItem-edit"
                        data-open-edit-cart
                        data-edit-cart-url="{{ item.url }}&view=ajax_edit_cart"
                        data-edit-cart-id="{{ item.id }}"
                        data-edit-cart-quantity="{{ item.quantity }}"
                        data-line="{{ item.key }}"
                        title="{{ 'sections.cart.edit_title' | t: title: item.variant.title }}"
                      >
                        {% render 'icon-edit' %}
                      </button>
                    {%- endif -%}
                  </div>
                {%- endunless -%}
              {%- endif -%}

              {% comment %}
                <dl class="card-properties definitionList cart-item-properties">
                  {%- if item.properties.size != 0 -%}
                    {%- for property in item.properties -%}
                      {%- assign property_first_char = property.first | slice: 0 -%}
                      {%- if property.last != blank and property_first_char != '_' -%}
                        <div class="product-option">
                          <dt class="definitionList-key">{{ property.first }}:</dt>
                          <dd class="definitionList-value">
                            {%- if property.last contains '/uploads/' -%}
                              <a href="{{ property.last }}" target="_blank">
                                {{ property.last | split: '/' | last }}
                              </a>
                            {%- else -%}
                              {{ property.last }}
                            {%- endif -%}
                          </dd>
                        </div>
                      {%- endif -%}
                    {%- endfor -%}
                  {%- endif -%}
                </dl>
              {% endcomment %}
              {%- if item.discounts.size > 0 -%}
                <ul class="cart-discounts list-unstyled" role="list" aria-label="{{ 'customer.order.discount' | t }}">
                  {%- for discount in item.discounts -%}
                    <li class="discounts__discount" data-auto-discount="{{ discount.total_savings }}">
                      {%- render 'icon-discount' -%}
                      {{ discount.title }}
                    </li>
                  {%- endfor -%}
                </ul>
              {%- endif -%}
              <div class="previewCartItem-change">
                {%- liquid
                  if item.original_price != item.final_price
                    assign price_to_display = item.final_price
                  else
                    assign price_to_display = item.original_price
                  endif
                -%}
                <div
                  class="previewCartItem-price"
                  data-price="{{ price_to_display }}"
                  data-original-price="{{ item.original_price }}"
                >
                  <span class="price">
                    {%- assign current_variant = item.variant -%}
                    {% if item.original_price != item.final_price %}
                      <span class="previewCartItem-saving-price">
                        <s class="before-discount-price" data-item-original-price-display>
                          {{ item.original_price | money }}
                        </s>
                        <span class="discounted-price" data-item-final-price-display>
                          {{ item.final_price | money }}
                        </span>
                      </span>
                    {% elsif current_variant.compare_at_price > current_variant.price %}
                      <span class="previewCartItem-saving-price saved_compare_price" data-price-from-compare>
                        <s class="before-discount-price">
                          {{ current_variant.compare_at_price | money }}
                        </s>
                        <span class="discounted-price">
                          {{ current_variant.price | money }}
                        </span>
                      </span>
                    {% else %}
                      <span data-item-final-price-display>
                        {{ item.price | money }}
                      </span>
                    {% endif %}
                  </span>
                </div>
                <cart-update-quantity
                  class="previewCartItem-qty"
                  data-product="{{ item.product_id }}"
                  data-variant="{{ item.variant.id }}"
                >
                  <label class="form-label hiddenLabels" for="upsell-update-{{ item.id }}">
                    {{ 'sections.cart.heading.quantity' | t }}
                  </label>
                  <a href="#" data-minus-quantity-cart="" class="minus btn-quantity"></a>
                  <input
                    class="form-input quantity"
                    name="quantity"
                    id="upsell-update-{{ item.id }}"
                    data-qtt-id1="quantity{{ item.id }}"
                    value="{{ item.quantity }}"
                    type="number"
                    {% if item.variant.inventory_management != null and item.variant.inventory_quantity > 0 %}
                      data-inventory-quantity="{{ item.variant.inventory_quantity }}"
                    {% endif %}
                    data-cart-quantity
                    data-cart-quantity-id="{{ item.id }}"
                    data-line="{{ item.key }}"
                  >
                  <a href="#" data-plus-quantity-cart="" class="plus btn-quantity"></a>
                </cart-update-quantity>
              </div>
            </div>
            <div
              class="pruebas-test"
              style="
                background-color: chocolate;
                display: flex;
                flex-direction: column;
                gap: 10px;
              "
            >
              <button
                type="button"
                class="previewCartItem-remove"
                data-cart-remove
                data-cart-remove-id="{{ item.id }}"
                data-line="{{ item.key }}"
                title="{{ 'sections.cart.remove_title' | t: title: item.title }}"
              >
                {% render 'icon-arrow-back-test1' %}
              </button>
              <button
                type="button"
                class="previewCartItem-remove"
                data-cart-remove
                data-cart-remove-id="{{ item.id }}"
                data-line="{{ item.key }}"
                title="{{ 'sections.cart.remove_title' | t: title: item.title }}"
              >
                {% render 'icon-close' %}
              </button>
            </div>
          </li>
        {% endcomment %}
        <div style="width: 100%; max-width: 460px; display: flex; flex-direction: column; padding-bottom: 25px; border-bottom: 1px solid var(--form-input-border); margin-top: 19px; gap: 10px;">
          <!-- Movemos el input al inicio del contenedor principal para que funcione el selector -->
          <input type="checkbox" id="toggle-{{ item.id }}" style="display: none;">
          <div class="auxiliar-test" style="width: 100%; height: 100%; display: flex; flex-direction: row; gap: 10px;">
            <!-- Contenedor de imagen -->
            <div style="flex: 0 0 16%; min-width: 70px; display: flex; align-items: center; justify-content: center;">
              <a
                href="{{ item.url }}"
                class="previewCartItem-image"
                style="display: flex; align-items: center; justify-content: center; width: 100%;"
              >
                <img
                  srcset="{{ item.image | img_url: '110x' }}"
                  src="{{ item.image | img_url: '110x' }}"
                  alt="{{ item.title | escape }}"
                  style="width: 100%; height: auto; object-fit: contain; display: block; max-width: 100%;"
                  loading="lazy"
                >
              </a>
            </div>
            <!-- Contenedor de información -->
            <div style="flex: 1; min-width: 0; padding: 0 10px; display: flex; flex-direction: column; justify-content: space-between;">
              <a
                class="previewCartItem-name link-underline"
                href="{{ item.url }}"
                style="display: block; margin-bottom: 10px;"
              >
                <span
                  class="text"
                  style="font-weight: var(--font-heading-weight) !important; font-size: clamp(14px, 2vw, 16px);"
                >
                  {{- item.product.title -}}
                </span>
              </a>
              <div class="previewCartItem-change" style="display: flex; flex-wrap: wrap; align-items: center;">
                {%- liquid
                  if item.original_price != item.final_price
                    assign price_to_display = item.final_price
                  else
                    assign price_to_display = item.original_price
                  endif
                -%}
                <div
                  class="previewCartItem-price"
                  data-price="{{ price_to_display }}"
                  data-original-price="{{ item.original_price }}"
                >
                  <span class="price">
                    {%- assign current_variant = item.variant -%}
                    {% if item.original_price != item.final_price %}
                      <span class="previewCartItem-saving-price">
                        <s class="before-discount-price" data-item-original-price-display>
                          {{ item.original_price | money }}
                        </s>
                        <span class="discounted-price" data-item-final-price-display>
                          {{ item.final_price | money }}
                        </span>
                      </span>
                    {% elsif current_variant.compare_at_price > current_variant.price %}
                      <span class="previewCartItem-saving-price saved_compare_price" data-price-from-compare>
                        <s class="before-discount-price">
                          {{ current_variant.compare_at_price | money }}
                        </s>
                        <span class="discounted-price">
                          {{ current_variant.price | money }}
                        </span>
                      </span>
                    {% else %}
                      <span data-item-final-price-display>
                        {{ item.price | money }}
                      </span>
                    {% endif %}
                  </span>
                </div>
                <cart-update-quantity
                  class="previewCartItem-qty"
                  data-product="{{ item.product_id }}"
                  data-variant="{{ item.variant.id }}"
                >
                  <label class="form-label hiddenLabels" for="upsell-update-{{ item.id }}">
                    {{ 'sections.cart.heading.quantity' | t }}
                  </label>
                  <a href="#" data-minus-quantity-cart="" class="minus btn-quantity"></a>
                  <input
                    class="form-input quantity"
                    name="quantity"
                    id="upsell-update-{{ item.id }}"
                    data-qtt-id1="quantity{{ item.id }}"
                    value="{{ item.quantity }}"
                    type="number"
                    {% if item.variant.inventory_management != null and item.variant.inventory_quantity > 0 %}
                      data-inventory-quantity="{{ item.variant.inventory_quantity }}"
                    {% endif %}
                    data-cart-quantity
                    data-cart-quantity-id="{{ item.id }}"
                    data-line="{{ item.key }}"
                  >
                  <a href="#" data-plus-quantity-cart="" class="plus btn-quantity"></a>
                </cart-update-quantity>
              </div>
            </div>
            <!-- Contenedor de botones -->
            <div style="flex: 0 0 auto; max-width: 40px; min-width: 30px; display: flex; flex-direction: column; gap: 10px;">
              <button
                type="button"
                class="previewCartItem-remove"
                data-cart-remove
                data-cart-remove-id="{{ item.id }}"
                data-line="{{ item.key }}"
                title="{{ 'sections.cart.remove_title' | t: title: item.title }}"
                style="padding: 5px; width: 100%; display: flex; align-items: center; justify-content: center;"
              >
                {% render 'icon-close' %}
              </button>
              {% comment %}
                <button
                  type="button"
                  title="Mostrar Detalles"
                  class="previewCartItem-remove"
                  style="padding: 5px; width: 100%; display: flex; align-items: center; justify-content: center;"
                >
                  {% render 'icon-arrow-back-test1' %}
                </button>
              {% endcomment %}
              <label
                for="toggle-{{ item.id }}"
                title="Mostrar Detalles"
                class="previewCartItem-remove"
                style="padding: 5px; width: 100%; display: flex; align-items: center; justify-content: center; cursor: pointer;"
              >
                <span style="transition: transform 0.3s ease; display: flex;">
                  {% render 'icon-arrow-back-test1' %}
                </span>
              </label>
            </div>
          </div>
          <div
            class="details-container-{{ item.id }}"
            style="width: 100%; height: auto; background-color: #f3f3f3; overflow: hidden; transition: height 0.3s ease-in-out; padding: 20px; border-radius: 8px;"
          >
            <div style="max-width: 600px; margin: 0 auto;">
              <!-- TAMAÑO -->
              <div style="margin-bottom: 20px;">
                <h3 style="color: #333; font-size: 18px; margin-bottom: 10px; border-bottom: 2px solid #e0e0e0; padding-bottom: 5px;">
                  TAMAÑO
                </h3>
                <div style="padding: 10px; background-color: white; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                  <p style="margin: 0; font-weight: bold; color: #444;">
                    Super personal para 2 a 3 personas
                    <span style="float: right; color: #d32f2f;">9bs</span>
                  </p>
                </div>
              </div>

              <!-- EXTRA -->
              <div style="margin-bottom: 20px;">
                <h3 style="color: #333; font-size: 18px; margin-bottom: 10px; border-bottom: 2px solid #e0e0e0; padding-bottom: 5px;">
                  EXTRA
                </h3>
                <div style="padding: 10px; background-color: white; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                  <p style="margin: 0 0 8px 0; color: #444;">
                    Extra Jamón
                    <span style="float: right; color: #d32f2f;">5bs</span>
                  </p>
                  <p style="margin: 0; color: #444;">
                    Extra Choclo
                    <span style="float: right; color: #d32f2f;">12bs</span>
                  </p>
                </div>
              </div>

              <!-- BORDE Y MASA -->
              <div style="margin-bottom: 20px;">
                <h3 style="color: #333; font-size: 18px; margin-bottom: 10px; border-bottom: 2px solid #e0e0e0; padding-bottom: 5px;">
                  BORDE Y MASA
                </h3>
                <div style="padding: 10px; background-color: white; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                  <p style="margin: 0; font-weight: bold; color: #444;">
                    PAN PIZZA + BORDE HOT CHESSE
                    <span style="float: right; color: #d32f2f;">12bs</span>
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      {%- endfor -%}
    </ul>

    {%- if settings.show_quick_cart_popular_product -%}
      {%- liquid
        assign collection = collections[settings.quick_cart_popular_product_collection]
        assign limit = settings.quick_cart_popular_product_show
        assign show_dots = settings.quick_cart_popular_product_dots
        assign show_arrows = settings.quick_cart_popular_product_arrows
      -%}
      <div class="previewCartCollection">
        {% if settings.quick_cart_popular_product_title != blank %}
          <div class="previewCartTitle text-left">
            {{ settings.quick_cart_popular_product_title | escape }}
          </div>
        {% endif %}
        <div class="previewCartProduct" data-product-collection-cart>
          <div
            class="previewCartCarousel products-carousel"
            data-item-dots="{{ show_dots }}"
            data-item-arrows="{{ show_arrows }}"
          >
            {%- for product in collection.products limit: limit -%}
              <div class="product">
                {% render 'product-card-sidebar', product_card_product: product %}
              </div>
            {%- else -%}
              {%- for product in (1..limit) -%}
                <div class="product">
                  {% capture current %}{% cycle 1, 2, 3, 4, 5, 6 %}{% endcapture %}
                  {% render 'product-card-custom-placeholder', index: current %}
                </div>
              {%- endfor -%}
            {%- endfor -%}
          </div>
        </div>
      </div>
    {%- endif -%}
  </div>

  <div class="previewCartInfo">
    <ul class="previewCartTotalsPrice list-unstyled">
      <li class="previewCartTotals subTotal clearfix">
        <div class="previewCartTotals-label">
          {{ 'sections.cart.subtotal' | t }}
        </div>
        <div class="previewCartTotals-value" data-cart-subtotal>
          {{ cart.original_total_price | money }}
        </div>
      </li>
      <li
        class="previewCartTotals cart-total-savings"
        {% if item.original_price == item.price %}
          style="display: none;"
        {% endif %}
        data-saved-discount-display
      >
        <div class="previewCartTotals-label">
          <span class="text">{{ 'general.cart.are_saving' | t }}</span>
        </div>
        <div class="previewCartTotals-value">
          <span class="text" data-saved-discount-value>{{ cart.total_discount | money }}</span>
        </div>
      </li>
      <li class="previewCartTotals total clearfix">
        <div class="previewCartTotals-label">
          {{ 'general.cart.total' | t }}
        </div>
        <div class="previewCartTotals-value" data-cart-total-value="{{ cart.total_price }}">
          {{ cart.total_price | money }}
        </div>
      </li>
      {% if settings.show_shipping_note %}
        {% comment %}
          <li class="previewCartTotals shipTotal clearfix">
              <div class="previewCartTotals-value">
                  {{ 'sections.cart.taxes_included_but_shipping_at_checkout' | t }}
              </div>
          </li>
        {% endcomment %}
      {% endif %}
    </ul>
    <div class="previewCartAction text-left">
      {% comment %}
        {%- if settings.show_global_checkbox -%}
          <div class="previewCartCheckbox global-checkbox">
            <input
              class="global-checkbox--input"
              type="checkbox"
              name="conditions"
              id="sidebar_cart_conditions"
              data-target="#cart-sidebar-checkout"
            >
            <label class="global-checkbox--label form-label--checkbox" for="sidebar_cart_conditions">
              {{ settings.global_checkbox_text }}
            </label>
            {%- if settings.global_checkbox_link_text != blank -%}
              <button type="button" title="{{ settings.global_checkbox_link_text | escape }}" data-term-condition>
                {{ settings.global_checkbox_link_text | escape }}
              </button>
            {%- endif -%}
          </div>
        {%- endif -%}
      {% endcomment %}
      <div class="previewCartGroup">
        <button
          class="button button-1 button-checkout"
          onclick="window.location='{{ routes.cart_url | split: '/cart' | first }}/checkout'"
          id="cart-sidebar-checkout"
        >
          {{ 'sections.cart.checkout' | t }}
        </button>
        <a class="button button-2 button-view-cart" href="{{ routes.cart_url }}">
          {{ 'sections.cart.view_cart' | t }}
        </a>
      </div>
    </div>
  </div>
{% else %}
  <div class="previewCart">
    <div class="previewCart-emptyBody text-center">
      <div class="empty">
        <div class="empty-icon">
          {% render 'icon-cart-03' %}
        </div>
        <span class="text">
          {{ 'sections.cart.empty' | t }}
        </span>
      </div>
      <a
        class="button button-2 button-continue"
        {% if settings.quick_cart_redirect_button == 'go_back' %}
          role="link" aria-disabled="true"
          onclick="window.history.back();"
        {% elsif settings.quick_cart_redirect_button == 'link_to' %}
          href="{{ settings.quick_cart_redirect_button_link }}"
        {% else %}
          role="link" aria-disabled="true"
          onclick="window.location.reload();"
        {% endif %}
      >
        {{ 'sections.cart.continue_shopping' | t }}
      </a>
    </div>
  </div>
{% endunless %}
{% comment %} asdasda {% endcomment %}
<style>
  @media screen and (max-width: 767px) {
    .previewCartItem-change {
      flex-direction: column;
      align-items: flex-start !important;
    }

    .previewCartItem-qty {
      width: 100%;
      justify-content: flex-start;
    }
  }

  /* Para rotar el ícono - ajustamos el selector para llegar al span dentro del label */
  input[type='checkbox']:checked ~ .auxiliar-test label span {
    transform: rotate(180deg);
  }

  /* Para el contenedor de detalles - ajustamos la altura específica */
  input[type='checkbox']:checked ~ div[class^='details-container-'] {
    height: 400px !important; /* o el valor que necesites */
  }

  /* Para el contenedor - mantenemos la transición */
  div[class^='details-container-'] {
    height: 0 !important; /* Aseguramos que empiece cerrado */
    padding: 0 !important; /* Quitamos el padding cuando está cerrado */
    transition: height 0.3s ease-in-out;
  }

  /* Cuando está abierto, restauramos el padding */
  input[type='checkbox']:checked ~ div[class^='details-container-'] {
    padding: 20px !important;
  }
</style>
